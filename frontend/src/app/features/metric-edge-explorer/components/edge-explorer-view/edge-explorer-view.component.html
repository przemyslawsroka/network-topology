<div class="edge-explorer-container">
  <div class="header">
    <h1 class="page-title">Metric Edge Explorer</h1>
    <p class="page-description">
      Analyze network connections, traffic metrics, and performance data between nodes in your infrastructure.
    </p>
  </div>

  <div class="controls-section">
    <mat-card class="controls-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>filter_list</mat-icon>
          Filters & Controls
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="controls-row">
          <div class="action-buttons">
            <button mat-raised-button color="primary" (click)="fetchData()" [disabled]="isLoading">
              <mat-icon>play_arrow</mat-icon>
              Run Query
            </button>
            <button mat-stroked-button (click)="exportData()">
              <mat-icon>download</mat-icon>
              Export
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Query Details Panel -->
  <div class="query-details-section" *ngIf="querySummary">
    <mat-expansion-panel [expanded]="true">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>info</mat-icon>
          Query Details
        </mat-panel-title>
        <mat-panel-description>
          <span [ngClass]="querySummary.totalSuccess ? 'status-success' : 'status-error'">
            {{ querySummary.totalSuccess ? 'All Succeeded' : 'Some Failed' }}
          </span>
          - Total Time: {{ querySummary.totalLatency }}ms
        </mat-panel-description>
      </mat-expansion-panel-header>
      
      <div class="query-details-content">
        <div *ngFor="let result of querySummary.results" class="detail-row metric-result">
          <mat-icon [ngClass]="result.success ? 'status-success' : 'status-error'">
            {{ result.success ? 'check_circle' : 'error' }}
          </mat-icon>
          <span class="metric-name">{{ result.metric }}</span>
          <span class="latency">({{ result.latency }}ms)</span>
          <span *ngIf="!result.success" class="error-message">{{ result.errorMessage }}</span>
        </div>
      </div>
    </mat-expansion-panel>
  </div>

  <div class="data-table-section">
    <mat-card class="data-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>hub</mat-icon>
          Network Connections
        </mat-card-title>
        <mat-card-subtitle>
          Detailed view of all network edges and their metrics
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="groupedConnections" class="edges-table">
          <!-- Source Column -->
          <ng-container matColumnDef="source">
            <th mat-header-cell *matHeaderCellDef>Source</th>
            <td mat-cell *matCellDef="let group">
              <div class="node-cell source-cell">
                <mat-icon class="node-icon">device_hub</mat-icon>
                <div>
                  <strong>{{ group.source.name }}</strong>
                  <div class="resource-type">{{ group.source.type }}</div>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Granularity Column -->
          <ng-container matColumnDef="granularity">
            <th mat-header-cell *matHeaderCellDef>Granularity</th>
            <td mat-cell *matCellDef="let group">
              <div class="granularity-cell">
                {{ group.granularity }}
              </div>
            </td>
          </ng-container>

          <!-- Target Column -->
          <ng-container matColumnDef="target">
            <th mat-header-cell *matHeaderCellDef>Target</th>
            <td mat-cell *matCellDef="let group">
              <div *ngFor="let item of group.targets" class="target-row">
                <mat-icon class="node-icon">arrow_forward</mat-icon>
                <div>
                  {{ item.target.name }}
                  <div class="resource-type">{{ item.target.type }}</div>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Metric Name Column -->
          <ng-container matColumnDef="metricName">
            <th mat-header-cell *matHeaderCellDef>Metric</th>
            <td mat-cell *matCellDef="let group">
              <div *ngFor="let item of group.targets" class="target-row">
                {{ item.metricName }}
              </div>
            </td>
          </ng-container>

          <!-- Metric Value Column -->
          <ng-container matColumnDef="metricValue">
            <th mat-header-cell *matHeaderCellDef>Metric Value</th>
            <td mat-cell *matCellDef="let group">
              <div *ngFor="let item of group.targets" class="target-row">
                {{ item.metricValue }}
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>
</div>
