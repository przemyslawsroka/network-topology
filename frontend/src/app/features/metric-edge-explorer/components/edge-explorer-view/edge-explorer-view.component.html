<div class="edge-explorer-container">
  <div class="header">
    <h1 class="page-title">Metric Edge Explorer</h1>
    <p class="page-description">
      Analyze network connections, traffic metrics, and performance data between nodes in your infrastructure.
    </p>
  </div>

  <div class="controls-section">
    <mat-card class="controls-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>filter_list</mat-icon>
          Filters & Controls
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="controls-row">
          <mat-form-field appearance="outline">
            <mat-label>Edge Type</mat-label>
            <mat-select [(value)]="selectedEdgeType">
              <mat-option value="all">All Types</mat-option>
              <mat-option value="vm_to_vm">VM to VM</mat-option>
              <mat-option value="external_to_lb">External to LB</mat-option>
              <mat-option value="lb_to_backend">LB to Backend</mat-option>
              <mat-option value="vm_to_vpn">VM to VPN</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Metric</mat-label>
            <mat-select [(value)]="selectedMetric">
              <mat-option value="traffic">Traffic</mat-option>
              <mat-option value="latency">Latency</mat-option>
              <mat-option value="packet_loss">Packet Loss</mat-option>
            </mat-select>
          </mat-form-field>

          <div class="action-buttons">
            <button mat-raised-button color="primary" (click)="fetchData()" [disabled]="isLoading">
              <mat-icon>play_arrow</mat-icon>
              Run Query
            </button>
            <button mat-stroked-button (click)="exportData()">
              <mat-icon>download</mat-icon>
              Export
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Query Details Panel -->
  <div class="query-details-section" *ngIf="queryDetails">
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>info</mat-icon>
          Query Details
        </mat-panel-title>
        <mat-panel-description>
          <span [ngClass]="queryDetails.success ? 'status-success' : 'status-error'">
            {{ queryDetails.success ? 'Success' : 'Error' }}
          </span>
          - {{ queryDetails.latency }}ms
        </mat-panel-description>
      </mat-expansion-panel-header>
      
      <div class="query-details-content">
        <div class="detail-row">
          <strong>Metric:</strong>
          <code>{{ queryDetails.metric }}</code>
        </div>
        <div class="detail-row">
          <strong>Query:</strong>
          <code>{{ queryDetails.query }}</code>
        </div>
        <div class="detail-row">
          <strong>Latency:</strong>
          <span>{{ queryDetails.latency }}ms</span>
        </div>
        <div class="detail-row">
          <strong>Status:</strong>
          <span [ngClass]="queryDetails.success ? 'status-success' : 'status-error'">
            <mat-icon>{{ queryDetails.success ? 'check_circle' : 'error' }}</mat-icon>
            {{ queryDetails.success ? 'Success' : 'Error' }}
          </span>
        </div>
        <div class="detail-row" *ngIf="!queryDetails.success && queryDetails.errorMessage">
          <strong>Error Message:</strong>
          <span class="error-message">{{ queryDetails.errorMessage }}</span>
        </div>
      </div>
    </mat-expansion-panel>
  </div>

  <div class="data-table-section">
    <mat-card class="data-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>hub</mat-icon>
          Network Connections
        </mat-card-title>
        <mat-card-subtitle>
          Detailed view of all network edges and their metrics
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="connections" class="edges-table">
          <ng-container matColumnDef="source">
            <th mat-header-cell *matHeaderCellDef>Source</th>
            <td mat-cell *matCellDef="let connection">
              <div class="node-cell">
                <mat-icon class="node-icon">device_hub</mat-icon>
                {{ connection.source }}
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="target">
            <th mat-header-cell *matHeaderCellDef>Target</th>
            <td mat-cell *matCellDef="let connection">
              <div class="node-cell">
                <mat-icon class="node-icon">device_hub</mat-icon>
                {{ connection.target }}
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="metricValue">
            <th mat-header-cell *matHeaderCellDef>Metric Value</th>
            <td mat-cell *matCellDef="let connection">{{ connection.metricValue }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>
</div>
