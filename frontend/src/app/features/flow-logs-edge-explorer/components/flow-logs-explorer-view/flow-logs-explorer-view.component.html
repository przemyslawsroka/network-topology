<div class="flow-logs-explorer-container">
  <div class="header">
    <h1 class="page-title">Flow Logs Edge Explorer</h1>
    <p class="page-description">
      Analyze VPC Flow Logs data to understand network traffic patterns, security events, and connectivity between instances.
    </p>
  </div>

  <div class="controls-section">
    <mat-card class="controls-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>filter_list</mat-icon>
          Filters & Controls
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="controls-row">
          <mat-form-field appearance="outline">
            <mat-label>Protocol</mat-label>
            <mat-select>
              <mat-option value="all">All Protocols</mat-option>
              <mat-option value="tcp">TCP</mat-option>
              <mat-option value="udp">UDP</mat-option>
              <mat-option value="icmp">ICMP</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Action Filter</mat-label>
            <mat-select>
              <mat-option value="all">All Actions</mat-option>
              <mat-option value="accept">Accept</mat-option>
              <mat-option value="reject">Reject</mat-option>
              <mat-option value="drop">Drop</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Time Range</mat-label>
            <mat-select>
              <mat-option value="1h">Last Hour</mat-option>
              <mat-option value="6h">Last 6 Hours</mat-option>
              <mat-option value="24h">Last 24 Hours</mat-option>
              <mat-option value="7d">Last 7 Days</mat-option>
            </mat-select>
          </mat-form-field>

          <div class="action-buttons">
            <button mat-raised-button color="primary" (click)="refreshData()">
              <mat-icon>refresh</mat-icon>
              Refresh
            </button>
            <button mat-stroked-button (click)="exportData()">
              <mat-icon>download</mat-icon>
              Export
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="metrics-overview">
    <div class="metric-card">
      <mat-card>
        <mat-card-content>
          <div class="metric-value">{{ flowLogs.length }}</div>
          <div class="metric-label">Total Flow Records</div>
        </mat-card-content>
      </mat-card>
    </div>
    <div class="metric-card">
      <mat-card>
        <mat-card-content>
          <div class="metric-value">{{ totalFlowsMB.toFixed(1) }} MB</div>
          <div class="metric-label">Total Data Transfer</div>
        </mat-card-content>
      </mat-card>
    </div>
    <div class="metric-card">
      <mat-card>
        <mat-card-content>
          <div class="metric-value">{{ averageDuration.toFixed(1) }}s</div>
          <div class="metric-label">Avg Flow Duration</div>
        </mat-card-content>
      </mat-card>
    </div>
    <div class="metric-card">
      <mat-card>
        <mat-card-content>
          <div class="metric-value">{{ acceptedFlowsCount }}/{{ rejectedFlowsCount }}</div>
          <div class="metric-label">Accepted/Rejected</div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <div class="data-table-section">
    <mat-card class="data-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>network_check</mat-icon>
          VPC Flow Logs
        </mat-card-title>
        <mat-card-subtitle>
          Detailed view of network flows and traffic between instances
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="flowLogs" class="flow-logs-table">
          <ng-container matColumnDef="srcInstance">
            <th mat-header-cell *matHeaderCellDef>Source</th>
            <td mat-cell *matCellDef="let flow">
              <div class="instance-cell">
                <mat-icon class="instance-icon">computer</mat-icon>
                <div class="instance-info">
                  <div class="instance-name">{{ flow.srcInstance }}</div>
                  <div class="instance-addr">{{ flow.srcAddr }}</div>
                </div>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="dstInstance">
            <th mat-header-cell *matHeaderCellDef>Destination</th>
            <td mat-cell *matCellDef="let flow">
              <div class="instance-cell">
                <mat-icon class="instance-icon">computer</mat-icon>
                <div class="instance-info">
                  <div class="instance-name">{{ flow.dstInstance }}</div>
                  <div class="instance-addr">{{ flow.dstAddr }}</div>
                </div>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="protocol">
            <th mat-header-cell *matHeaderCellDef>Protocol</th>
            <td mat-cell *matCellDef="let flow">
              <mat-chip-set>
                <mat-chip [ngClass]="getProtocolClass(flow.protocol)">{{ flow.protocol }}</mat-chip>
              </mat-chip-set>
            </td>
          </ng-container>

          <ng-container matColumnDef="ports">
            <th mat-header-cell *matHeaderCellDef>Ports</th>
            <td mat-cell *matCellDef="let flow">
              <div class="ports-info">
                <span class="port-mapping">{{ flow.srcPort }} â†’ {{ flow.dstPort }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="bytes">
            <th mat-header-cell *matHeaderCellDef>Data Transfer</th>
            <td mat-cell *matCellDef="let flow">{{ formatBytes(flow.bytes) }}</td>
          </ng-container>

          <ng-container matColumnDef="packets">
            <th mat-header-cell *matHeaderCellDef>Packets</th>
            <td mat-cell *matCellDef="let flow">{{ flow.packets | number }}</td>
          </ng-container>

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>Action</th>
            <td mat-cell *matCellDef="let flow">
              <mat-chip-set>
                <mat-chip [ngClass]="getActionClass(flow.action)">
                  <mat-icon *ngIf="flow.action === 'ACCEPT'">check_circle</mat-icon>
                  <mat-icon *ngIf="flow.action === 'REJECT'">block</mat-icon>
                  <mat-icon *ngIf="flow.action === 'DROP'">cancel</mat-icon>
                  {{ flow.action }}
                </mat-chip>
              </mat-chip-set>
            </td>
          </ng-container>

          <ng-container matColumnDef="duration">
            <th mat-header-cell *matHeaderCellDef>Duration</th>
            <td mat-cell *matCellDef="let flow">{{ formatDuration(flow.start, flow.end) }}</td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>
</div>
